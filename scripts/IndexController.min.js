/*! wedding - v0.0.0 - 2016-02-21 */
"use strict";angular.module("WeddingApp").directive("descriptionContent",function(){return{restrict:"E",scope:!1,link:function(a,b,c){a.getContentUrl=function(){return"templates/"+a.data.view+".html"}},template:'<div ng-include="getContentUrl()"></div>'}}).controller("IndexController",["$scope","$q","$timeout","_","Parse","Helper","moment",function(a,b,c,d,e,f,g){function h(b){a.data.reservation.inProgress=!1,alert(b)}function i(){a.data.guestBook.addingNewComment=!1,a.data.guestBook.newComment.name="",a.data.guestBook.newComment.message=""}var j={firstName:"",lastName:"",initial:"",email:"",coming:!0},k="linear-gradient( rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5) )",l=function(b){a.$broadcast("backgroundImageBackdrop:update",b)};a.data={view:"home",guestBook:{addingNewComment:!1,comments:[],newComment:{name:"",message:""}},album:{options:{index:0},startEvent:"START_GALLERY",slides:[{src:"images/album/0.jpg",w:1012,h:668},{src:"images/album/1.jpg",w:764,h:668},{src:"images/album/2.jpg",w:631,h:668},{src:"images/album/3.jpg",w:480,h:668},{src:"images/album/4.jpg",w:806,h:668},{src:"images/album/5.jpg",w:557,h:500},{src:"images/album/6.jpg",w:442,h:668},{src:"images/album/7.jpg",w:431,h:668},{src:"images/album/8.jpg",w:560,h:668},{src:"images/album/9.jpg",w:1152,h:2048},{src:"images/album/10.jpg",w:3024,h:2016}],thumbs:[{src:"images/album/0-t.jpg"},{src:"images/album/1-t.jpg"},{src:"images/album/2-t.jpg"},{src:"images/album/3-t.jpg"},{src:"images/album/4-t.jpg"},{src:"images/album/5-t.jpg"},{src:"images/album/6-t.jpg"},{src:"images/album/7-t.jpg"},{src:"images/album/8-t.jpg"},{src:"images/album/9-t.jpg"},{src:"images/album/10-t.jpg"}]},party:{bridesmaids:[{name:"Imani Golding - Maid of Honor",description:"",avatar:"images/party/imaniGolding.jpg"},{name:"Kathleen Siapno",description:"Hello everyone! My name is Kathleen and I like to sing, travel, and bake cupcakes. I attended Sophie Davis and SUNY Downstate with Kayla and am training to be a pediatrician. In our eight years of friendship, Kayla and I have mastered ballet, bought matching Sherlock Holmes hats, and sat up all night in front of Rockefeller Center (in frigid November!) for SNL tickets. I am excited to add Kayla and Konstantinâ€™s wedding to this list of adventures.",avatar:"images/party/kathleenSiapno.jpg"},{name:"Stephanie Shen",description:"Hi everyone, my name is Stephanie. I am in my last year of medical school at NYU, applying into Anesthesia just like Kayla. I've known this lovely, kind, super smart girl since we met first year of Sophie Davis in 2008 and we've been partners in crime ever since. I'm thrilled she's found her soulmate and can't wait for the wedding!",avatar:"images/party/stephanieShen.jpg"},{name:"Keisha Barry",description:"Hey everyone! My name is Keisha. I  am a Zumba fanatic and big health and wellness advocate. Kay(la) and I have been friends for the past 10 years. Although we went to the same high school (Brooklyn Tech - our student body was over 4000!!), I officially met and befriended Kay during Summer 2006 at a STEM program at the City College of NY. Our bond grew that summer over math problems, handball in the park and commutes back to Flatbush (we live very close to each other). We've been inseparable ever since. After Tech, we attended the same schools for undergrad and medical school. I can always count on Kay for her  words of encouragement or advice whether academically or personally. Konsty, I'm sure you already know this, but you have selected one special lady to be your wife. I can see too that she is in good hands. I wish you guys the best and many, many years of wedded bliss!",avatar:"images/party/keishaBarry.jpg"},{name:"Krystianni Hills",description:"My name is Krystianni Hills and I love working with children and finding the best in people. I am a middle school English and Science teacher in New York City. I've known Kayla since elementary school. We were both a part of a special after school program and so we would take the train together. We ended up going to the same high school and that solidified our friendship. I've watch Kayla grow into the beautify young lady that she is today and I am so proud of all of her accomplishments and may God continue to bless you.",avatar:"images/party/krystianniHills.jpg"},{name:"Tiffany",description:"Hey everyone, I'm Tiffany. I currently wors as a home health aide, and also pursuing my degree in health and human services. I actually will be graduating in September. I love writing poems, working on music and I love to read black novels. I've known Kay forever we go bay back since Nextel phones, lol. We have done a lot of things together. One memorable moment is when we went to the juvert parade and had a blast. We always have a good time.",avatar:"images/party/tiffany2.jpg"},{name:"Rasheeda DeVerteuil",description:"Hi, my name is Rasheeda. I love shopping and art. I am currently getting my masters in School Psychology. I am extremely excited that my cousin is getting married!",avatar:"images/party/rasheeda2.jpg"}],groomsmen:[{name:"Alexander Astafurov",description:"Hey everyone, I am Konsti's brother Alex. We've been together with Konsti from the start (more like my birth, since I am younger), we even came to US at the same time. I love a lot of things my brother does and even followed his footsteps to become a Software Engineer, however Konsti's true passion is in fact Medicine and helping other people. That is why he decided to pursue a goal of becoming a doctor :]. When Konsti meets someone he loves - he disappears for a while, and with Kay it was no different ;) That is how I know that he loves her and I am very happy for both of them! ",avatar:"images/party/alexa.jpg"}]},attendence:{attendies:[],notAttendies:[],addAttendies:function(b){a.data.attendence.attendies=a.data.attendence.attendies.concat(b)},addNotAttendies:function(b){a.data.attendence.notAttendies=a.data.attendence.notAttendies.concat(b)},hasEmail:function(a){return this.emails.indexOf(a)>-1},getEmails:function(a){var b="attendies"===a?this.attendies:this.notAttendies;return d.map(b,function(a){return a.email})},hasName:function(a){return this.names.indexOf(a)>-1},hasAttending:function(a){return this.hasAttendingOfType("attendies",a)},hasNotAttending:function(a){return this.hasAttendingOfType("notAttendies",a)},hasAttendingOfType:function(a,b){var c=this.getAttendieName(b,!1),d=!1,e=0,f="attendies"===a?this.attendies:this.notAttendies,g=f.length;for(e;g>e;e++)if(this.getAttendieName(f[e],!1)===c){f[e].email===b.email?d=!0:this.getAttendieName(f[e],!0)===this.getAttendieName(b,!0)&&(d=!0);break}return d},getAudienceNames:function(a,b){var c=this,e="attendies"===a?this.attendies:this.notAttendies;return d.map(e,function(a){return c.getAttendieName(a,b)})},getAttendiesNamesSeparatedByComma:function(a){var b=this,c="";return a.forEach(function(a,d){c+=(d?", ":"")+b.getAttendieName(a,!1)}),c},getAttendieName:function(a,b){return a.firstName+" "+a.lastName+(b?" "+a.initial:"")}},reservation:{inProgress:!1,songRequests:"",attendies:[d.clone(j)]},video:{source:"JI23BzW8kdA",height:"0",width:"1",player:null,playing:!1}},a.showGallery=function(b){console.log("Showing gallery"),a.data.album.options.index=b,a.$broadcast(a.data.album.startEvent)};var m={initialized:!1,queried:null,ReservationCollector:null,GuestBookCollector:null,initializeParse:function(){this.initialized||(e.initialize("7MSlb2EIj05DYLBlvWoHEc2PXbJYbEQKrog75wxa","jhpakFRx9LBOyru93ZoBQw5DH7xP5xLkllCja4MT"),this.initialized=!0,this.ReservationCollector=e.Object.extend("ReservationCollector"),this.GuestBookCollector=e.Object.extend("GuestBookCollector"))},getParseReservationCollector:function(){return this.initializeParse(),new this.ReservationCollector},getGuestBookCollector:function(){return this.initializeParse(),new this.GuestBookCollector},getGuestBookComments:function(){var b=this;if(b.initializeParse(),!b.queriedComments){var c=new e.Query(b.GuestBookCollector);c.find({success:function(c,d){a.$apply(function(){b.queriedComments=!0,console.log(c),c.forEach(function(b){console.log(b);var c={};c.name=b.get("name"),c.message=b.get("message"),c.createdAt=b.get("createdAt"),a.data.guestBook.comments.unshift(c)})})},error:function(a){console.log("Error: "+a.code+" "+a.message)}})}},getParseReservations:function(){var b=this;if(b.initializeParse(),!b.queried){var c=new e.Query(b.ReservationCollector);c.find({success:function(c,d){a.$apply(function(){b.queried=!0,console.log(c),c.forEach(function(b){a.data.attendence.addAttendies(b.get("attending")),a.data.attendence.addNotAttendies(b.get("notAttending"))}),console.log(a.data.attendence.attendies),console.log(a.data.attendence.notAttendies)})},error:function(a){console.log("Error: "+a.code+" "+a.message)}})}}};a.getPage=function(b){b!==a.data.view&&(a.data.view="home",c(function(){"home"!==b&&(a.data.view=b)},300))},a.addNewAttendie=function(){a.data.reservation.attendies.push(d.clone(j))},a.removeAttendie=function(b){console.log(b),a.data.reservation.attendies.splice(a.data.reservation.attendies.indexOf(b),1)},a.$watch("data.view",function(a,b){a!==b&&("home"===a?l({backgroundShadow:""}):("rsvp"===a?m.getParseReservations():"guestBook"===a&&m.getGuestBookComments(),l({backgroundShadow:k})))}),a.makeReservation=function(){a.data.reservation.inProgress=!0;var b=d.cloneDeep(a.data.reservation),c="",e=0;b=d.pick(d.extend(b,d.map(b.attendies,d.partialRight(d.pick,d.keys(j)))),["songRequests","attendies"]),console.log(b);for(var g=0;g<b.attendies.length;g++)if(c="",(""===b.attendies[g].firstName||""===b.attendies[g].lastName)&&(c+="Please enter both first name and last name!"),""!==b.attendies[g].email&&(f.validateEmail(b.attendies[g].email)?e++:c+='Please enter correct email address(es)! Entered: "'+b.attendies[g].email+'".'),""!==c)return h(c);if(1>e)return h("We need at least one email address!");if(a.data.reservation.inProgress){b.songRequests=f.trimAndSplitStringList(b.songRequests);var i=d.partition(b.attendies,{coming:!0});delete b.attendies,b.attending=d.map(i[0].filter(function(b){return!a.data.attendence.hasAttending(b)}),d.partialRight(d.omit,["coming"])),b.notAttending=d.map(i[1].filter(function(b){return!a.data.attendence.hasNotAttending(b)}),d.partialRight(d.omit,["coming"]));d.reduce(b.attending,function(a,b){var c=b.firstName+" "+b.lastName;return a?a+", "+c:c},"");return console.log(b),b.attending.length||b.notAttending.length?void m.getParseReservationCollector().save(b).then(function(c){a.$apply(function(){a.data.attendence.addAttendies(b.attending),a.data.attendence.addNotAttendies(b.notAttending);var c=a.data.attendence.getAttendiesNamesSeparatedByComma(b.attending),d=a.data.attendence.getAttendiesNamesSeparatedByComma(b.notAttending),e="";c.length&&(e+="Thank you for making a reservation, "+c+"!"),d.length&&(e+=(c.length?" ":"")+"Sorry to hear that you are not attending, "+d+", but thank you for letting us know!"),h(e)})},function(b){a.$apply(function(){h("Sorry, there was a problem on our end :s. Please try hitting that button again!")})}):h("You already submitted your reservation before, please contact Kayla & Kostya directly!")}},a.postNewComment=function(){var b=d.cloneDeep(a.data.guestBook.newComment);return b.name&&b.message?void m.getGuestBookCollector().save(b).then(function(d){a.$apply(function(){b.createdAt=g().toDate(),a.data.guestBook.comments.unshift(b),i(),c(function(){alert("Thank you for your comment!")})})},function(){a.$apply(function(){return alert("Sorry, there was a problem on our end :s. Please try hitting that button again!")})}):alert("Please provide your name as well as message!")},a.removeNewComment=function(){i()},a.$on("youtube.player.ready",function(a,b){console.log("player is ready"),b.playVideo()}),a.$on("youtube.player.ended",function(a,b){console.log("player video has ended")}),a.playOrPausePlayer=function(){"playing"===a.data.video.player.currentState?a.data.video.player.pauseVideo():a.data.video.player.playVideo()},a.stopPlayer=function(){a.data.video.player.stopVideo()}}]);